<script src="../node_modules/vue/dist/vue.js"></script>

<div id="app">
    <smart-avatar username="guaxiao"></smart-avatar>
</div>

<script>
    var log = console.log.bind(console)
    // mock API
    var fetchURL = function (username, callback) {
        // 这里我们叫不实现 username 转 URL 的逻辑啦
        // 用 setTimeout 模拟一下
        setTimeout(() => {
            callback('https://avatars3.githubusercontent.com/u/13295397?s=200&v=4')
        }, 500)
    }

    var Avatar = {
        props: ['src'],
        template: `<img :src="src">`
    }

    var withAvatarURL = function (InnerComponent) {
        var props = ['username']

        var data = function () {
            return { url: `http://via.placeholder.com/154x154` }
        }

        var created = function () {
            fetchURL(this.username, url => {
                this.url = url
            })
        }

        var render = function (h) {
            return h(InnerComponent, {
                props: { src: this.url }
            })
        }

        return { props, data, created, render }
    }

    var SmartAvatar = withAvatarURL(Avatar)

    var app = new Vue({
        el: '#app',
        components: { SmartAvatar }
    })
</script>