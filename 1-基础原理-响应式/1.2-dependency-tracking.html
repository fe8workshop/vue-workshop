<script>
    // Dep (dependency)
    class Dep {
        constructor() {
            this.list = new Set()
        }

        depend() {
            if (Dep.target) {
                this.list.add(Dep.target)
            }
        }

        notify() {
            this.list.forEach(sub => sub())
        }
    }
    // Dep 的 静态属性 target
    Dep.target = null

    var autorun = function (update) {
        var target = () => {
            Dep.target = target
            update()
            Dep.target = null
        }
        target()
    }

    // 这里我把 Dep 暴露给 window 方便测试
    window.Dep = Dep
</script>